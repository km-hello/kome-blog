/* ================================================================
   kome-blog 全局样式
   ================================================================
   结构：
   1. 外部依赖导入（Tailwind、highlight.js、KaTeX）
   2. 全局基础样式（@layer base）
   3. 工具类（@layer utilities）
   4. Markdown 排版（.markdown-body）
   5. Memo Markdown 覆盖（.markdown-compact / .markdown-mini）
   ================================================================ */

/* ---------- 1. 外部依赖导入 ---------- */

/* Tailwind CSS v4 核心 */
@import "tailwindcss";

/* highlight.js 代码高亮主题 */
@import "highlight.js/styles/github.css";

/* KaTeX 数学公式渲染样式 */
@import "katex/dist/katex.min.css";

/* ---------- 2. 全局基础样式 ---------- */

@layer base {
  /* 统一所有元素的默认边框和轮廓颜色 */
  * {
    border-color: oklch(0.922 0 0);       /* slate-200 */
    outline-color: oklch(0.708 0 0 / 50%); /* slate-400 半透明 */
  }

  /* 页面背景和文字颜色 */
  body {
    background-color: oklch(0.965 0.003 261.0);     /* 浅灰蓝背景 */
    color: oklch(0.145 0 0);       /* 接近纯黑的正文色 */
  }

  /* 全局页面滚动条：细窄风格 */
  html {
    scrollbar-width: thin;                             /* Firefox */
    scrollbar-color: rgb(226 232 240) transparent;     /* Firefox：滑块色 / 轨道色 */
    &::-webkit-scrollbar {
      width: 4px;
    }
    &::-webkit-scrollbar-track {
      background: transparent;
    }
    &::-webkit-scrollbar-thumb {
      background-color: rgb(226 232 240);  /* slate-200 */
      border-radius: 4px;
    }
    &:hover::-webkit-scrollbar-thumb {
      background-color: rgb(203 213 225);  /* slate-300，hover 加深 */
    }
  }
}

/* ---------- 3. 工具类 ---------- */

@layer utilities {
  /*
   * .scrollbar-thin — 局部细滚动条
   * 用于侧边栏、代码区等需要独立滚动的容器
   * 同时兼容 Webkit（Chrome/Safari/Edge）和 Firefox
   */
  .scrollbar-thin {
    &::-webkit-scrollbar {
      width: 4px;
      height: 4px;
    }
    &::-webkit-scrollbar-track {
      background: transparent;
    }
    &::-webkit-scrollbar-thumb {
      background-color: rgb(226 232 240);
      border-radius: 4px;
    }
    &:hover::-webkit-scrollbar-thumb {
      background-color: rgb(203 213 225);
    }
    scrollbar-width: thin;
    scrollbar-color: rgb(226 232 240) transparent;
  }

  /*
   * .bento-card — 卡片容器通用样式
   * 白底圆角 + 微弱边框和阴影，hover 时边框加深、阴影扩散
   * 用于首页文章卡片、侧边栏组件、Memo 卡片等
   */
  .bento-card {
    @apply bg-white rounded-xl transition-all;
    border: 1px solid rgba(0, 0, 0, 0.04);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);

    &:hover {
      border-color: rgba(0, 0, 0, 0.12);
      box-shadow: 0 8px 24px -6px rgba(0, 0, 0, 0.06), 0 2px 6px -1px rgba(0, 0, 0, 0.02);
    }
  }
}

/* ================================================================
   4. Markdown 排版（.markdown-body）
   用于文章详情页和 Memo 内容的富文本渲染
   由 useMarkdown composable 输出的 HTML 使用此 class
   ================================================================ */

/* --- 基础排版 --- */

.markdown-body {
  color: #334155;        /* slate-700 */
  line-height: 1.85;
  font-size: 1.05rem;
}

.markdown-body strong {
  font-weight: 700 !important;
  color: #0f172a;        /* slate-900 */
}

.markdown-body em {
  font-style: italic !important;
  color: #64748b;        /* slate-500 */
}

/* --- 标题 h1 ~ h4 --- */

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4 {
  color: #0f172a;
  font-weight: 700;
  margin-top: 2.5rem;
  margin-bottom: 1.2rem;
  line-height: 1.3;
  scroll-margin-top: 6rem;  /* 锚点跳转时预留顶部空间 */
}

.markdown-body h1 {
  font-size: 2rem;
  border-bottom: 1px solid #e2e8f0;
  padding-bottom: 0.5rem;
}

.markdown-body h2 {
  font-size: 1.6rem;
}

.markdown-body h3 {
  font-size: 1.35rem;
}

.markdown-body h4 {
  font-size: 1.15rem;
}

/* 文章开头第一个标题不需要顶部间距 */
.markdown-body > h1:first-child,
.markdown-body > h2:first-child,
.markdown-body > h3:first-child {
  margin-top: 0;
}

/* --- 段落 --- */

.markdown-body p {
  margin-bottom: 1.5rem;
  text-align: justify;   /* 两端对齐 */
}

/* --- 列表 --- */

.markdown-body ul {
  list-style-type: disc;
  padding-left: 1.5rem;
  margin-bottom: 1.5rem;
  color: #475569;        /* slate-600 */
}

.markdown-body ol {
  list-style-type: decimal;
  padding-left: 1.5rem;
  margin-bottom: 1.5rem;
  color: #475569;
}

.markdown-body li {
  margin-bottom: 0.5rem;
}

/* 嵌套列表：消除多余下边距 */
.markdown-body li > ul,
.markdown-body li > ol {
  margin-top: 0.5rem;
  margin-bottom: 0;
}

/* --- 链接 --- */

.markdown-body a {
  color: #3b82f6;        /* blue-500 */
  text-decoration: none;
  font-weight: 500;
  border-bottom: 1px solid transparent;
  transition: border-color 0.2s;
}

.markdown-body a:hover {
  border-bottom-color: #3b82f6;
}

/* --- 引用块 --- */

.markdown-body blockquote {
  border-left: 4px solid #cbd5e1;   /* slate-300 */
  background-color: #f8fafc;        /* slate-50 */
  padding: 1rem 1.5rem;
  border-radius: 0 0.5rem 0.5rem 0;
  margin: 2rem 0;
  color: #475569;
  font-style: italic;
}

.markdown-body blockquote p:last-child {
  margin-bottom: 0;
}

/* --- 行内代码 --- */

.markdown-body code:not(pre code) {
  background-color: #f1f5f9;
  border: 1px solid #e2e8f0;
  color: #475569;
  padding: 0.2em 0.45em;
  border-radius: 0.25rem;
  font-size: 0.85em;
  font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, monospace;
  font-weight: 500;
}

/* --- 代码块（由 useMarkdown 包裹为 .code-block > .code-header + pre）--- */

.markdown-body .code-block {
  position: relative;
  margin: 1.5rem 0;
}

/* 复制按钮容器：默认隐藏，hover 代码块时显示 */
.markdown-body .code-block .code-header {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.markdown-body .code-block:hover .code-header {
  opacity: 1;
}

/* 复制按钮 */
.markdown-body .code-block .code-copy-btn {
  display: flex;
  align-items: center;
  padding: 0.2rem 0.5rem;
  border: none;
  border-radius: 0.25rem;
  background-color: #e2e8f0;
  color: #64748b;
  font-size: 0.7rem;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.15s ease;
  text-transform: lowercase;
  user-select: none;
}

.markdown-body .code-block .code-copy-btn:hover {
  background-color: #cbd5e1;
  color: #475569;
}

/* 复制按钮：已复制 / 未复制 状态切换 */
.markdown-body .code-block .code-copy-btn .code-copied-text {
  display: none;
}

.markdown-body .code-block .code-copy-btn.copied {
  background-color: #d1fae5;  /* green-100 */
  color: #059669;             /* green-600 */
}

.markdown-body .code-block .code-copy-btn.copied .code-lang-text {
  display: none;
}

.markdown-body .code-block .code-copy-btn.copied .code-copied-text {
  display: inline;
}

/* .code-block 内的 pre 不需要额外 margin */
.markdown-body .code-block pre {
  margin: 0;
}

/* pre 块通用样式 */
.markdown-body pre {
  background-color: #f8fafc;
  border: 1px solid #f1f5f9;
  border-radius: 0.5rem;
  padding: 1rem;
  overflow-x: auto;
  margin: 1.5rem 0;
}

.markdown-body pre code {
  font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, monospace;
  font-size: 0.875rem;
  line-height: 1.7;
  background: transparent;
  border: none;
  padding: 0;
  color: inherit;
}

/* --- 表格 --- */

/* 外层容器处理横向溢出滚动 */
.markdown-body .table-wrapper {
  overflow-x: auto;
  margin: 2rem 0;
}

.markdown-body table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95rem;
}

.markdown-body th,
.markdown-body td {
  border: 1px solid #e2e8f0;
  padding: 0.75rem;
  text-align: left;
}

.markdown-body th {
  background-color: #f8fafc;
  font-weight: 600;
  color: #1e293b;
}

/* 斑马纹 */
.markdown-body tr:nth-child(even) {
  background-color: #fcfcfc;
}

/* --- 图片 --- */

.markdown-body img {
  max-width: 100%;
  height: auto;
  border-radius: 0.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  margin: 2.5rem auto 1rem auto;
  display: block;
}

/* 图片说明文字（由 useMarkdown 生成） */
.markdown-body .img-caption {
  text-align: center;
  display: block;
  font-size: 0.875rem;
  color: #94a3b8;
  margin-bottom: 2.5rem;
  font-style: normal;
}

/* --- 分割线 --- */

.markdown-body hr {
  border: none;
  border-top: 1px solid #e2e8f0;
  margin: 3rem 0;
}

/* --- 任务列表复选框 --- */

.markdown-body input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid #cbd5e1;
  border-radius: 0.25rem;
  margin-right: 0.5rem;
  vertical-align: middle;
  position: relative;
  top: -1px;
  cursor: default;
  transition: all 0.15s ease;
}

.markdown-body input[type="checkbox"]:checked {
  background-color: #64748b;
  border-color: #64748b;
}

/* 勾选标记（纯 CSS 绘制） */
.markdown-body input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 5px;
  top: 2px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* --- Mermaid 图表 --- */

.markdown-body .mermaid-container {
  display: flex;
  justify-content: center;
  background-color: #f8fafc;
  border: 1px solid #f1f5f9;
  padding: 2rem 1rem;
  border-radius: 0.5rem;
  margin: 2rem 0;
  overflow-x: auto;
}

/* 渲染完成后支持点击放大 */
.markdown-body .mermaid-container.mermaid-rendered {
  cursor: zoom-in;
  transition: box-shadow 0.2s ease;
}

.markdown-body .mermaid-container.mermaid-rendered:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.markdown-body .mermaid-container svg {
  max-width: 100%;
  height: auto;
}

/* --- KaTeX 数学公式 --- */

.markdown-body .katex-display {
  overflow-x: auto;
  overflow-y: hidden;
  padding: 1rem 0;
  margin: 1.5rem 0;
}

.markdown-body .katex {
  font-size: 1.1em;
}

/* --- Markdown 内可横向滚动区域的统一细滚动条 --- */

.markdown-body pre,
.markdown-body .table-wrapper,
.markdown-body .mermaid-container,
.markdown-body .katex-display {
  scrollbar-width: thin;
  scrollbar-color: rgb(226 232 240) transparent;
  &::-webkit-scrollbar {
    height: 4px;
  }
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  &::-webkit-scrollbar-thumb {
    background-color: rgb(226 232 240);
    border-radius: 4px;
  }
}

/* ================================================================
   5. Memo Markdown 覆盖
   在 .markdown-body 基础上叠加，缩小间距和字号
   ================================================================ */

/*
 * .markdown-compact — Memos 页面（中等尺寸）
 * 配合 .markdown-body 使用：<div class="markdown-body markdown-compact">
 * 正文 15px，间距比文章详情页更紧凑
 */

.markdown-compact p {
  margin: 0.5em 0;
  font-size: 15px;
  line-height: 1.6;
  color: #475569;
}

.markdown-compact p:first-child {
  margin-top: 0;
}

.markdown-compact p:last-child {
  margin-bottom: 0;
}

.markdown-compact ul,
.markdown-compact ol {
  margin: 0.5em 0;
  padding-left: 1.5em;
}

.markdown-compact li {
  margin: 0.25em 0;
  font-size: 15px;
}

.markdown-compact code:not(pre code) {
  font-size: 13px;
  padding: 0.15em 0.4em;
}

.markdown-compact .code-block {
  margin: 0.75em 0;
}

.markdown-compact blockquote {
  margin: 0.5em 0;
  padding: 0.5em 1em;
  font-size: 14px;
}

/* Memo 链接：蓝色 + hover 下划线动画，与 .markdown-body a 保持一致 */
.markdown-compact a {
  color: #3b82f6;
  text-decoration: none;
  font-weight: 500;
  border-bottom: 1px solid transparent;
  transition: border-color 0.2s;
}

.markdown-compact a:hover {
  border-bottom-color: #3b82f6;
}

/*
 * .markdown-mini — 首页侧边栏 LatestMemo（小尺寸）
 * 配合 .markdown-body 使用：<div class="markdown-body markdown-mini">
 * 正文 12px，极致紧凑，用于预览摘要
 */

.markdown-mini {
  font-size: 12px;
  line-height: 1.5;
  color: #475569;
}

.markdown-mini p {
  margin: 0.25em 0;
}

.markdown-mini p:first-child {
  margin-top: 0;
}

.markdown-mini ul,
.markdown-mini ol {
  margin: 0.25em 0;
  padding-left: 1.25em;
}

.markdown-mini li {
  margin: 0.125em 0;
}

.markdown-mini code:not(pre code) {
  font-size: 11px;
  padding: 0.1em 0.3em;
}

.markdown-mini .code-block {
  margin: 0.5em 0;
}

.markdown-mini pre {
  font-size: 11px;
  padding: 0.5em;
}

.markdown-mini blockquote {
  margin: 0.25em 0;
  padding: 0.25em 0.75em;
  font-size: 11px;
}

/* 预览中所有标题统一为正文大小，避免视觉跳跃 */
.markdown-mini h1,
.markdown-mini h2,
.markdown-mini h3,
.markdown-mini h4,
.markdown-mini h5,
.markdown-mini h6 {
  font-size: 12px;
  margin: 0.25em 0;
}

.markdown-mini a {
  color: #3b82f6;
  text-decoration: none;
  font-weight: 500;
  border-bottom: 1px solid transparent;
  transition: border-color 0.2s;
}

.markdown-mini a:hover {
  border-bottom-color: #3b82f6;
}

/* 预览中图片适应宽度，超出高度裁切隐藏 */
.markdown-mini img {
  width: 100%;
  max-height: 5em;
  object-fit: cover;
  border-radius: 6px;
  margin: 0.25em 0;
  box-shadow: none;
}

/* 预览中 Mermaid 图表紧凑显示 */
.markdown-mini .mermaid-container {
  padding: 0.25em;
  margin: 0.25em 0;
  border-radius: 6px;
  overflow: hidden;
}
